# 영속성 어댑터 구현하기

  - 의존성 역전
  - 영속성 어댑터의 책임
  - 포트 인터페이스 나누기
  - 영속성 어댑터 나누기
  - 스프링 데이터 JPA 예제
  
  
  ## 의존성 역전
  
  어플리케이션 서비스 에서는 영속성 기능을 사용하기 위해 포트 인터페이스를 호출한다.
  
  이 포트는 실제로 영속성 작업을 수행하고 데이터베이스와 통신할 책임을 가진 영속성 어댑터 클래스에 의해 구현된다.
  
  영속성 어댑터는 애플리케이션에 의해 호출 될 뿐, 애플리케이션을 호출하지는 않는다.
  
  포트는 사실상 어플리케이션 서비스와 영속성 코드 사이의 간접 계층이다. 영속성 문제에 신경 쓰지 않고 도메인 코드를 개발하기 위해, 즉 영속성 계층에 대한 코드 의존성을 없애기 위해 이러한 간접 계층을 추가하고 있다는 사실을 잊지 말자. 
  
  
  
  
  ## 영속성 어댑터의 책임
  
  1. 입력을 받는다.
  2. 입력을 데이터베이스 포맷으로 매핑한다.
  3. 입력을 데이터베이스로 보낸다.
  4. 데이터베이스 출력을 어플리케이션 포맷으로 매핑한다.
  5. 출력을 반환한다.


  영속성 어댑터는 포트 인터페이스를 통해 입력 받는다. 입력 모델은 인터페이스가 지정한 도메인 엔티티나 특정 데이터베이스 연산 전용 객체가 된다.
  
  그리고 나서 영속성 어댑터는 데이터베이스를 쿼리하거나 변경 하는데 사용할 수 있는 포맷으로 입력 모델을 매핑한다. 

  핵심은 영속성 어댑터의 입력 모델이 영속성 어댑터 내부에 있는 것이 아니라 어플리케이션 코어에 있기 때문에 영속성 어댑터 내부를 변경하는 것이 코어에 영향을 미치지 않는다.
  
  다음으로 영속성 어댑터는 데이터베이스에 쿼리를 날리고 쿼리 결과를 받아온다.
  
  마지막으로 데이터베이스 응답을 포트에 정의된 출력 모델로 매핑해서 반환한다. 
  
  
  ## 포트 인터페이스 나누기
  
  인터페이스 분리 원칙은 클라이언트가 오로지 자신이 필요로 하는 메서드만 알면 되도록 넓은 인터페이스를 특화된 인터페이스로 분리해야 한다고 설명한다.
  
